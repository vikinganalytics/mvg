name: update-documentation-examples

# Dependency workflow
# on:
#   workflow_run:
#     workflows: ["ci-checks"]
#     types: [completed]
on:
  pull_request:
    branches: [ master ]

# Prevent concurrent runs
concurrency:
    group: ${{ github.head_ref }}
    cancel-in-progress: true

# A set of tasks that represents the workflow
jobs:
    update-examples:
        runs-on: [ ubuntu-latest ]
        if: ${{ github.event.workflow_run.conclusion == 'success' and github.event_name == 'pull_request' }}
        name: "Update examples in documentation"
        steps:
        - uses: actions/checkout@v2
          with:
            ref: ${{ github.head_ref }}
        - name: "Install dependencies"
          run: |
            pip install notebook tqdm ipywidgets
            pip install -r requirements.txt
        - name: "Setup MVG"
          run: |
            pip install .
        - name: "Run all examples"
          env:
            TEST_TOKEN: ${{ secrets.TEST_TOKEN }}
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: |
            echo "Executing jupyter notebooks"
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/check_version.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/brief_overview.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/sources_and_measurements.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/tabular_example.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/error_handling.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/analysis_classes.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/analysis_visual.ipynb
            jupyter nbconvert --execute --to notebook --inplace docs/source/content/examples/labeling.ipynb
            echo "Done"
        - name: Push changes
          run: |
            echo "Add and commit changes"
            git config user.name github-actions
            git config user.email github-actions@github.com
            git add docs/source/content/examples/*.ipynb
            git commit -m "GitHub Actions: Updated examples in documentation"
            git push
            echo "Done"